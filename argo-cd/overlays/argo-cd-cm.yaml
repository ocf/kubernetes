apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
data:
  url: https://argocd.ocf.berkeley.edu
  # Temp workaround: hides all CiliumIdentities from ArgoCD's UI.
  resource.exclusions: |
    - apiGroups:
      - "cilium*"
      kinds:
      - "CiliumIdentity"
      clusters:
      - "*"
  repositories: |
    - url: https://github.com/ocf/kubernetes
  configManagementPlugins: |
    - name: kustomized-helm
      init:
        command: ["/bin/sh", "-c"]
        args: ["helm dependency build || true"]
      generate:
        command: ["/bin/sh", "-c"]
        args: ["helm template . --name-template $ARGOCD_APP_NAME --namespace $ARGOCD_APP_NAMESPACE --include-crds > all.yaml && kustomize build"]
    - name: python
      init:
        command: ["/bin/sh", "-c"]
        args: ["python -m pip install poetry"]
      generate:
        command: ["/bin/sh", "-c"]
        args: ["~/.local/bin/poetry install >/dev/null && ~/.local/bin/poetry run argocd-build"]
